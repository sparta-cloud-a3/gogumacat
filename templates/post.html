<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>고구마캣</title>

    <!-- font awesome -->
    <script src="https://kit.fontawesome.com/b8cc3ce1fa.js" crossorigin="anonymous"></script>

    <!-- bulma -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>

    <!-- google font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@500&display=swap" rel="stylesheet">

    <!--지도 api-->
    <script type="text/javascript"
            src="//dapi.kakao.com/v2/maps/sdk.js?appkey=9600c7eddf2d8ec432aa9d8791d1e471&libraries=services,clusterer,drawing"></script>

    <script src="{{ url_for('static',filename='like.js') }}"></script>
    <!-- css 분리-->
    <link rel="stylesheet" type="text/css" href="/static/css/post.css"/>


    <script>
        $(document).ready(function () {
            map()
        })

        //맵 생성하기
        function map() {
            var mapContainer = document.getElementById('map'), // 지도를 표시할 div
                mapCenter = new kakao.maps.LatLng(33.5563, 126.7958), // 지도의 중심좌표
                mapOption = {
                    center: mapCenter, // 지도의 중심좌표
                    level: 3 // 지도의 확대 레벨
                };

            var map = new kakao.maps.Map(mapContainer, mapOption);

// 커스텀 오버레이에 표시할 내용입니다
// HTML 문자열 또는 Dom Element 입니다
            var content = '<div class="overlay_info">';
            content += '    <a href="https://place.map.kakao.com/17600274" target="_blank"><strong>월정리 해수욕장</strong></a>';
            content += '    <div class="desc">';
            content += '        <img src="https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/place_thumb.png" alt="">';
            content += '        <span class="address">{{ post.address }}</span>';
            content += '    </div>';
            content += '</div>';

// 커스텀 오버레이가 표시될 위치입니다
            var position = new kakao.maps.LatLng(33.55635, 126.795841);

// 커스텀 오버레이를 생성합니다
            var mapCustomOverlay = new kakao.maps.CustomOverlay({
                position: position,
                content: content,
                xAnchor: 0.5, // 커스텀 오버레이의 x축 위치입니다. 1에 가까울수록 왼쪽에 위치합니다. 기본값은 0.5 입니다
                yAnchor: 1.1 // 커스텀 오버레이의 y축 위치입니다. 1에 가까울수록 위쪽에 위치합니다. 기본값은 0.5 입니다
            });

// 커스텀 오버레이를 지도에 표시합니다
            mapCustomOverlay.setMap(map);

            var rvContainer = document.getElementById('roadview'); //로드뷰를 표시할 div
            var rv = new kakao.maps.Roadview(rvContainer); //로드뷰 객체
            var rvClient = new kakao.maps.RoadviewClient(); //좌표로부터 로드뷰 파노ID를 가져올 로드뷰 helper객체

//지도의 중심좌표와 가까운 로드뷰의 panoId를 추출하여 로드뷰를 띄운다.
            rvClient.getNearestPanoId(mapCenter, 50, function (panoId) {
                rv.setPanoId(panoId, mapCenter); //panoId와 중심좌표를 통해 로드뷰 실행
            });

            kakao.maps.event.addListener(rv, 'init', function () {

                // 커스텀 오버레이를 생성합니다
                var rvCustomOverlay = new kakao.maps.CustomOverlay({
                    position: position,
                    content: content,
                    xAnchor: 0.5, // 커스텀 오버레이의 x축 위치입니다. 1에 가까울수록 왼쪽에 위치합니다. 기본값은 0.5 입니다
                    yAnchor: 0.5 // 커스텀 오버레이의 y축 위치입니다. 1에 가까울수록 위쪽에 위치합니다. 기본값은 0.5 입니다
                });

                //rvCustomOverlay.setAltitude(2); //커스텀 오버레이의 고도값을 설정합니다.(로드뷰 화면 중앙이 0입니다)
                rvCustomOverlay.setMap(rv);

                var projection = rv.getProjection(); // viewpoint(화면좌표)값을 추출할 수 있는 projection 객체를 가져옵니다.

                // 커스텀오버레이의 position과 altitude값을 통해 viewpoint값(화면좌표)를 추출합니다.
                var viewpoint = projection.viewpointFromCoords(rvCustomOverlay.getPosition(), rvCustomOverlay.getAltitude());

                rv.setViewpoint(viewpoint); //커스텀 오버레이를 로드뷰의 가운데에 오도록 로드뷰의 시점을 변화 시킵니다.
            });
        }

        function sign_out() {
            $.removeCookie('mytoken', {path: '/'});
            alert('로그아웃!')
            window.location.href = "/login"
        }

        function kakaoLogout() {
            if (Kakao.Auth.getAccessToken()) {
                Kakao.API.request({
                    url: '/v1/user/unlink',
                    success: function (response) {
                        console.log(response)
                    },
                    fail: function (error) {
                        console.log(error)
                    },
                })
                Kakao.Auth.setAccessToken(undefined)
            }
        }

        function roadview() {

        }

    </script>
</head>
<body>
<div class="sideBanner">
    <span class="txt-label">
    </span>
</div>

<div class="size">
    <div class="user">
        <section class="float-right login-btn" onclick="location.href='/user/{{ user_info.username }}'">
            <!--로그인-->
            <i class="fa-solid fa-cat fa-lg"></i>
            <span style="font-weight: bold">&nbsp;&nbsp;"{{ user_info.nickname }}"</span>님 환영합니다.
            <!--    <div class="logout">-->
            <!--        <a class="button level-item has-text-centered is-sparta is-outlined" aria-label="logout"-->
            <!--           onclick="sign_out()">-->
            <!--            로그아웃&nbsp;&nbsp;&nbsp;<span class="icon is-small"><i class="fa fa-sign-out" aria-hidden="true"></i></span>-->
            <!--        </a>-->
            <!--        <a class="button level-item has-text-centered is-sparta is-outlined" aria-label="logout"-->
            <!--           onclick="kakaoLogout()">-->
            <!--            카카오 로그아웃&nbsp;&nbsp;&nbsp;<span class="icon is-small"><i class="fa fa-sign-out"-->
            <!--                                                                     aria-hidden="true"></i></span>-->
            <!--        </a>-->
            <!--    </div>-->
            <!--로그인-->
        </section>
    </div>

    <section class="hero" onclick="window.location.href='/'" style='width: 300px; cursor:pointer;'>
        <div class="hero-body">
            <img class="hero-img" src="/static/gogumacat.png">
            <span class="title hero-font">
            고구마캣
        </span>
        </div>
    </section>
    </section>

    <div class="search">
        <input type="text" class="search-input" id="search-box" name="query" placeholder="검색어 입력">
        <img class="search-img" onclick="search()"
             src="https://s3.ap-northeast-2.amazonaws.com/cdn.wecode.co.kr/icon/search.png">
    </div>
    <div class="jumbotron jumbotron-fluid">
        <div class="container">
            <img src="{{ post.img_url }}"></h1>
        </div>
    </div>
    <div class="content">
        <div class="user-info" id="user_information">
            <h4 id="user_name">{{ post.username }}</h4>
            <h6 id="user_locate"> {{ post.address }}</h6>
            <hr>
            <div class="like-box">
                <a class="heart-icon" aria-label="like" onclick="toggle_like({{ post.idx }})"
                   style="float:right; margin: 40px 20px 0px 0px">
            <span class="icon is-small">
                {% if post.like_by_me %}
                    <i id="heart" class="fa-solid fa-heart fa-3x" aria-hidden="true"></i>
                {% else %}
                    <i id="heart" class="fa-regular fa-heart fa-3x" aria-hidden="true"></i>
                {% endif %}
            </span>
                </a>
                <div class="like-num" id="heart-count-box">
                    <script>num2str({{post.like_count}})</script>
                </div>
            </div>
        </div>
        <div class=content-name;>
            <h1>{{ post.title }}</h1>
            <h3>가격:{{ post.price }}</h3>
        </div>
{#지도, 로드뷰 띄우기 #}
        <div class="map" id="mapping">
            <div id="map" class="local" style="width:400px;height:350px;"></div> <!-- 지도를 표시할 div 입니다 -->
            <div id="roadview" class="road is-hidden" style="width:400px;height:350px"></div> <!-- 로드뷰를 표시할 div 입니다 -->
        </div>
        <button class="button is-info" style="display:block;margin:  auto" onclick="roadview()">로드뷰 보기</button>
        <div class="content-info">
            <h1> {{ post.content }}</h1>
        </div>
    </div>

    <div class="popup" id="frame" data-popup="popup-1" style="visibility:hidden; overflow-x:hidden;overflow-y:hidden">
        <iframe src="http://localhost:5000/posts/{{ post.idx }}/chat" width="300" height="468"></iframe>
    </div>
</div>
</body>
</html>