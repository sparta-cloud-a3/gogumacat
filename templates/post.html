<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>고구마캣</title>

    <!-- font awesome -->
    <script src="https://kit.fontawesome.com/b8cc3ce1fa.js" crossorigin="anonymous"></script>

    <!-- bulma -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>

    <!-- google font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@500&display=swap" rel="stylesheet">

    <script src="{{ url_for('static',filename='like.js') }}"></script>

    <style>
        *{
            font-family: 'Noto Sans KR', sans-serif;
        }
        body {
            width: 1200px;
            margin: auto;
        }

        .size{
            width: 1000px;
        }

        .hero-img {
            width: 60px;
            height: 60px;
        }

        .hero-font {
            /*color: #C886A4;*/
            color: #543343;
            font-family: 'Noto Sans KR', sans-serif;

        }

        .float-right {
            float: right;
        }

        .login-btn {
            margin-top: 10px;
        }

        .jumbo{
            padding-top: 30px;
            margin-bottom: 50px;
        }

        .container{
            width : 600px;
            height : 600px;
            padding-top: 0px;
            margin-top: 0px;
        }

        .write-btn {
            width: 100px;
            margin: 30px auto;
            display: block;
        }

        .search {
            position: relative;
            width: 1000px;
            margin: 0 auto 40px auto;
            cursor: pointer;
        }

        .search-input {
            width: 100%;
            border: 2px solid #bbb;
            border-radius: 6px;
            padding: 10px 12px;
            font-size: 18px;
        }

        .search-img {
            position: absolute;
            width: 18px;
            top: 16px;
            right: 12px;
        }
        #user_profile{
            float : left;
            width : 50px;
            height : 50px;
        }

        #user_name{
            margin-bottom: 0px;
        }

        .content-name{
            margin-left: 10px;
        }

        .card-box {
            margin-top: 30px;
        }

        .text-box {
            margin-top: 30px;
        }

        .logout {
            width: 200px;
            margin: auto;
        }

        .like {
            width: 400px;
            margin-left: auto;
        }

        #map {
            width: 60%;
            height: 500px;
            margin: 40px auto 40px auto;
            background-color: antiquewhite;
        }

        .sideBanner {
            float: right;
            position: relative;
            width: 150px;
            height: 150px;
            top: 1000px;
            background-size: cover;
            background-image: url(/static/gogumacat.png);
        }

        .emphasized {
            position: fixed;
            top: 150px;
            left: 30px;
            box-shadow: rgba(0, 0, 0, 0.5) 0 0 0 9999px, rgba(0, 0, 0, 0.5) 2px 2px 3px 3px;
            z-index: 100;

        }

        .user {
            height: 34px;
        }

        .like-box {
            float: right;
        }

        .like-num {

        }

        #heart {
            color : red;
        }

        .fa-solid{

        }

        .jello-horizontal {
            -webkit-animation: jello-horizontal 0.9s both;
            animation: jello-horizontal 0.9s both;
        }

        @-webkit-keyframes jello-horizontal {
            0% {
                -webkit-transform: scale3d(1, 1, 1);
                transform: scale3d(1, 1, 1);
            }
            30% {
                -webkit-transform: scale3d(1.25, 0.75, 1);
                transform: scale3d(1.25, 0.75, 1);
            }
            40% {
                -webkit-transform: scale3d(0.75, 1.25, 1);
                transform: scale3d(0.75, 1.25, 1);
            }
            50% {
                -webkit-transform: scale3d(1.15, 0.85, 1);
                transform: scale3d(1.15, 0.85, 1);
            }
            65% {
                -webkit-transform: scale3d(0.95, 1.05, 1);
                transform: scale3d(0.95, 1.05, 1);
            }
            75% {
                -webkit-transform: scale3d(1.05, 0.95, 1);
                transform: scale3d(1.05, 0.95, 1);
            }
            100% {
                -webkit-transform: scale3d(1, 1, 1);
                transform: scale3d(1, 1, 1);
            }
        }

        @keyframes jello-horizontal {
            0% {
                -webkit-transform: scale3d(1, 1, 1);
                transform: scale3d(1, 1, 1);
            }
            30% {
                -webkit-transform: scale3d(1.25, 0.75, 1);
                transform: scale3d(1.25, 0.75, 1);
            }
            40% {
                -webkit-transform: scale3d(0.75, 1.25, 1);
                transform: scale3d(0.75, 1.25, 1);
            }
            50% {
                -webkit-transform: scale3d(1.15, 0.85, 1);
                transform: scale3d(1.15, 0.85, 1);
            }
            65% {
                -webkit-transform: scale3d(0.95, 1.05, 1);
                transform: scale3d(0.95, 1.05, 1);
            }
            75% {
                -webkit-transform: scale3d(1.05, 0.95, 1);
                transform: scale3d(1.05, 0.95, 1);
            }
            100% {
                -webkit-transform: scale3d(1, 1, 1);
                transform: scale3d(1, 1, 1);
            }
        }

    </style>

    <script>
        {#let y_cen = {{post.y }};   // lat#}
        {#let x_cen = {{post.x}};  // long#}
        let map;
        let markers = [];
        let infowindows = [];

        $(document).ready(function () {
            var floatPosition = parseInt($(".sideBanner").css('top'))

            $(window).scroll(function () {

                // 현재 스크롤 위치
                var currentTop = $(window).scrollTop();
                var bannerTop = currentTop + floatPosition + "px";

                //이동 애니메이션
                $(".sideBanner").stop().animate({
                    "top": bannerTop
                }, 500);

            }).scroll();

            $(".sideBanner").click(function () {
                console.log(document.getElementById("frame").style.visibility)
                if (document.getElementById("frame").style.visibility == "hidden") {
                    document.getElementById("frame").style.visibility = "visible"
                    $("#frame").toggleClass("emphasized");

                } else {
                    document.getElementById("frame").style.visibility = "hidden"
                    window.location.href = "http://localhost:5000/posts/{{ post.idx }}"
                }
            });


            map = new naver.maps.Map('map', {
                center: new naver.maps.LatLng(y_cen, x_cen),
                zoom: 12,
                zoomControl: true,
                zoomControlOptions: {
                    style: naver.maps.ZoomControlStyle.SMALL,
                    position: naver.maps.Position.TOP_RIGHT
                }
            });

            //get_locate();

        });

        function search() {
            let query = $('#search-box').val();
            if (query == "") {
                alert("검색어를 입력하세요");
                return;
            } else {
                $.ajax({
                    type: "GET",
                    url: `/search?query=${query}`,
                    data: {},
                    success: function (response) {
                        $("#card-box").empty();
                        let posts = response["posts"];
                        for (let i = 0; i < posts.length; i++) {
                            make_post(posts[i], i);
                        }

                        $("#query-text-box").append(`"${query}" 검색내역 입니다.`)
                        $("#query-text-box").removeClass("is-hidden");
                    }
                });
            }
        }

        function sign_out() {
            $.removeCookie('mytoken', {path: '/'});
            alert('로그아웃!')
            window.location.href = "/login"
        }

        function kakaoLogout() {
            if (Kakao.Auth.getAccessToken()) {
                Kakao.API.request({
                    url: '/v1/user/unlink',
                    success: function (response) {
                        console.log(response)
                    },
                    fail: function (error) {
                        console.log(error)
                    },
                })
                Kakao.Auth.setAccessToken(undefined)
            }
        }


    </script>
</head>
<body>
<div class="sideBanner">
    <span class="txt-label">
    </span>
</div>
<div class = "size">
<div class="user">
    <section class="float-right login-btn" onclick="location.href='/user/{{user_info.username}}'">
        <!--로그인-->
        <i class="fa-solid fa-cat fa-lg"></i>
        <span style="font-weight: bold">&nbsp;&nbsp;"{{user_info.nickname}}"</span>님 환영합니다.
        <!--    <div class="logout">-->
        <!--        <a class="button level-item has-text-centered is-sparta is-outlined" aria-label="logout"-->
        <!--           onclick="sign_out()">-->
        <!--            로그아웃&nbsp;&nbsp;&nbsp;<span class="icon is-small"><i class="fa fa-sign-out" aria-hidden="true"></i></span>-->
        <!--        </a>-->
        <!--        <a class="button level-item has-text-centered is-sparta is-outlined" aria-label="logout"-->
        <!--           onclick="kakaoLogout()">-->
        <!--            카카오 로그아웃&nbsp;&nbsp;&nbsp;<span class="icon is-small"><i class="fa fa-sign-out"-->
        <!--                                                                     aria-hidden="true"></i></span>-->
        <!--        </a>-->
        <!--    </div>-->
        <!--로그인-->
    </section>
</div>

<section class="hero" onclick="window.location.href='/'">
    <div class="hero-body">
        <img class="hero-img" src="/static/gogumacat.png">
        <span class="title hero-font">
            고구마캣
        </span>
    </div>
</section>
</section>

<div class="search">
    <input type="text" class="search-input" id="search-box" name="query" placeholder="검색어 입력">
    <img class="search-img" onclick="search()"
         src="https://s3.ap-northeast-2.amazonaws.com/cdn.wecode.co.kr/icon/search.png">
</div>
<div class="jumbo" >
    <div class="container">
        <img src="/static/post_pic/{{post.file}}" style="width : 600px; height: 600px;">
    </div>
</div>
<div class="content">
    <div class="user-info" id="user_information">
        <img src = "/static/{{user.profile_pic_real}}" id = user_profile>
        <h4 id="user_name">{{post.nickname}}</h4>
        <h6 id="user_locate"> {{post.address}}</h6>
        <hr>
        <div class="like-box">
            <a class="heart-icon" id="heart_a" aria-label="like" onclick="toggle_like({{post.idx}})" style="float:right; margin: 40px 20px 0px 0px">
            <span class="icon is-small">
                {% if post.like_by_me %}
                    <i id="heart" class="fa-solid fa-heart fa-3x" aria-hidden="true"></i>
                {% else %}
                    <i id="heart" class="fa-regular fa-heart fa-3x" aria-hidden="true"></i>
                {% endif %}
            </span>
            </a>
            <div class="like-num" id="heart-count-box"><script>num2str({{post.like_count}})</script></div>
        </div>
    </div>
    <div class=content-name;>
        <h1>{{ post.title }}</h1>
        <h3>{{ post.price }}원 (1일 기준)</h3>
    </div>
    <div id="map">
        <h1>지도 들어가요</h1>
    </div>
    <div class="content-info">
        <p>상품 설명</p>
        <h1> {{post.content}}</h1>
    </div>
</div>

<div class="popup" id="frame" data-popup="popup-1" style="visibility:hidden; overflow-x:hidden;overflow-y:hidden">
    <iframe src="http://localhost:5000/posts/{{ post.idx }}/chat" width="300" height="468" ></iframe>
</div>
</div>
</body>
</html>