<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Webpage Title -->
    <title>GOGUMACAT</title>


    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bulma CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css">
    <!-- Font Awesome CSS -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

    <!-- JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>

    <!-- 주소 검색 API-->
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <!--지도 api-->
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=9600c7eddf2d8ec432aa9d8791d1e471&libraries=services,clusterer,drawing"></script>
    <meta charset="UTF-8">


    <style>
        .hero-img {
            width: 60px;
            height: 60px;
        }

        .hero-font {
            /*color: #C886A4;*/
            color: #543343;
            font-family: 'Noto Sans KR', sans-serif;

        }

        .wrap {
            width: 700px;
            margin: 100px auto 0px auto;
        }

        .input {
            margin-top: 10px;
        }

        input::placeholder {
            color: black;
            font-weight: bold;
        }

        textarea::placeholder {
            color: black;
            font-size: 1.2em;
            font-weight: bold;
        }
        .posting {
            margin-right: 20px;
            float: right;
        }

    </style>
    <script>
        $(document).ready(function () {
            fileupload()
        })

        //파일 업로드 시 제목 띄우기
        function fileupload() {
            const fileInput = document.querySelector('#file-js-example input[type=file]');

            fileInput.onchange = () => {
                if (fileInput.files.length > 0) {
                    const fileName = document.querySelector('#file-js-example .file-name');
                    fileName.textContent = fileInput.files[0].name;
                }
            }
        }

        function img_up() {
            // 이미지 업로드
            $('#img').on('change', function () {
                ext = $(this).val().split('.').pop().toLowerCase(); //확장자
                //배열에 추출한 확장자가 존재하는지 체크
                if ($.inArray(ext, ['gif', 'png', 'jpg', 'jpeg']) == -1) {
                    resetFormElement($(this)); //폼 초기화
                    window.alert('이미지 파일이 아닙니다! (gif, png, jpg, jpeg 만 업로드 가능)');
                } else {
                    file = $('#img').prop("files")[0];
                    blobURL = window.URL.createObjectURL(file);
                    $('#image_preview img').attr('src', blobURL);
                    $('#image_preview').slideDown(); //업로드한 이미지 미리보기
                    $(this).slideUp(); //파일 양식 감춤
                    $("#image_preview").toggleClass("is-hidden")
                }
            });
        }


        //지도 띄우는 코드
        function map() {
            $("#map").toggleClass("is-hidden")
            let local = $('#local_address').val()
            var mapContainer = document.getElementById('map'), // 지도를 표시할 div
                mapOption = {
                    center: new kakao.maps.LatLng(33.450701, 126.570667), // 지도의 중심좌표
                    level: 3 // 지도의 확대 레벨
                };

            // 지도를 생성합니다
            var map = new kakao.maps.Map(mapContainer, mapOption);

            // 주소-좌표 변환 객체를 생성합니다
            var geocoder = new kakao.maps.services.Geocoder();

            // 주소로 좌표를 검색합니다
            geocoder.addressSearch(local, function (result, status) {

                // 정상적으로 검색이 완료됐으면
                if (status === kakao.maps.services.Status.OK) {

                    var coords = new kakao.maps.LatLng(result[0].y, result[0].x);

                    // 결과값으로 받은 위치를 마커로 표시합니다
                    var marker = new kakao.maps.Marker({
                        map: map,
                        position: coords
                    });

                    // 인포윈도우로 장소에 대한 설명을 표시합니다
                    var infowindow = new kakao.maps.InfoWindow({
                        content: '<div style="width:150px;text-align:center;padding:6px 0;">직거래장소</div>'
                    });
                    infowindow.open(map, marker);

                    // 지도의 중심을 결과값으로 받은 위치로 이동시킵니다
                    map.setCenter(coords);
                }
            });
        }

        function local_search() {
            new daum.Postcode({
                oncomplete: function (data) {
                    var addr = data.address; // 최종 주소 변수

                    // 주소 정보를 해당 필드에 넣는다.
                    document.getElementById("local_address").value = addr
                }
            }).open();
        }

    </script>

</head>
<body>
{#상단 배너#}
<section class="hero" onclick="window.location.href='/'" style="width: 250px;height: 50px; cursor: pointer; ">
    <div class="hero-body">
        <img class="hero-img" src="/static/gogumacat.png">
        <span class="title hero-font">
            고구마캣
        </span>
    </div>
</section>
<h3 class="title is-3" style="text-align: center;">대여 등록하기 </h3>
{#전체 입력 글#}
<div class="wrap">
    <input class="input is-normal" type="text" placeholder="제목, 물품명을 적어주세요">
    <input class="input is-normal" type="text" placeholder="대여 가능한 날짜를 적어주세요">
    <input class="input is-normal" type="text" placeholder="가격(1일 기준 대여가격)">
    {#이미지 업로드 부분#}
    <div id="file-js-example" class="file has-name is-info">
        <label class="file-label " style="margin-top: 10px">
            <input class="file-input" type="file" name="resume" id="img" onclick="img_up()"
                   accept="image/jpeg, image/jpg, image/png"/>
            <span class="file-cta">
      <span class="file-label">제품 사진</span>
    </span>
            <span class="file-name"></span>
        </label>
    </div>
    {#이미지 미리보기#}
    <div id="image_preview" class="is-hidden">
        <img style="width:300px;height: 200px">
    </div>
    {#상세내용#}
    <textarea class="textarea" style="margin-top: 10px" placeholder="상세 내용을 적어주세요" rows="5"></textarea>
    {#주소 검색부분#}
    <div class="field">
        <input id="local_address" class="input" type="text" placeholder="직거래 위치 찾기" style="width: 400px"
               onclick="local_search()">
        <input type="button" class="button is-info" onclick="map()" value="검색" style="margin-top: 10px">
    </div>
    {#지도api#}
    <div id="map" class="is-hidden" style="width: 500px;height:300px;margin:10px auto 50px auto;"></div>
</div>
<button class="button is-info posting" >등록하기</button>
</body>
</html>